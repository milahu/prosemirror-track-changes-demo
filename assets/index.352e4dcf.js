var t=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(e,a,r)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,s=(t,e)=>{for(var a in e||(e={}))n.call(e,a)&&i(t,a,e[a]);if(r)for(var a of r(e))o.call(e,a)&&i(t,a,e[a]);return t};import{t as c,o as l,n as d,m as u,S as p,D as f,N as m,a as h,P as g,c as v,b as y,d as k,j as b,s as w,u as O,r as M,e as _,f as A,g as S,h as D,M as E,i as N,k as T,l as x,p as P,q as j,v as B,w as I,x as z,y as L,z as C,A as R,B as q,C as J,E as $,F,T as U,G as V,R as H,H as W,I as G,J as Q,K as Z,L as Y,O as K,Q as X,U as tt,V as et,W as at,X as rt,Y as nt,Z as ot}from"./vendor.26614ef1.js";const it=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},st=function(t,e,a={}){return a.target=t.target.closest(e),!!a.target&&(t.stopPropagation(),!0)},ct={attrs:{type:{default:""},key:{default:""},value:{default:""}},inclusive:!1,excludes:"",group:"annotation",parseDOM:[{tag:"span.annotation-tag[data-type]",getAttrs:t=>({type:t.dataset.type,key:t.dataset.key?t.dataset.key:"",value:t.dataset.value?t.dataset.value:""})}],toDOM(t){var e,a;const r={class:"annotation-tag","data-type":t.attrs.type};return(null==(e=t.attrs.key)?void 0:e.length)&&(r["data-key"]=t.attrs.key),(null==(a=t.attrs.value)?void 0:a.length)&&(r["data-value"]=t.attrs.value),["span",r]}},lt={attrs:{id:{default:!1}},inclusive:!1,excludes:"",group:"annotation",parseDOM:[{tag:"span.comment[data-id]",getAttrs:t=>({id:parseInt(t.dataset.id)})}],toDOM:t=>["span",{class:"comment","data-id":t.attrs.id}]};function dt(t){if(!t)return[];let e;try{e=JSON.parse(t)}catch(a){return[]}return Array.isArray(e)?e.filter((t=>t.hasOwnProperty("user")&&t.hasOwnProperty("username")&&t.hasOwnProperty("date"))):[]}function ut(t,e){var a;(null==(a=t.attrs.track)?void 0:a.length)&&(e["data-track"]=JSON.stringify(t.attrs.track))}const pt={attrs:{user:{default:0},username:{default:""},date:{default:0}},inclusive:!1,group:"track",parseDOM:[{tag:"span.deletion",getAttrs:t=>({user:parseInt(t.dataset.user),username:t.dataset.username,date:parseInt(t.dataset.date)})}],toDOM:t=>["span",{class:`deletion user-${t.attrs.user}`,"data-user":t.attrs.user,"data-username":t.attrs.username,"data-date":t.attrs.date}]};function ft(t){if(!t)return[];let e;try{e=JSON.parse(t)}catch(a){return[]}return Array.isArray(e)?e.filter((t=>"string"==typeof t)):[]}const mt={attrs:{user:{default:0},username:{default:""},date:{default:0},before:{default:[]},after:{default:[]}},inclusive:!1,group:"track",parseDOM:[{tag:"span.format-change",getAttrs:t=>({user:parseInt(t.dataset.user),username:t.dataset.username,date:parseInt(t.dataset.date),before:ft(t.dataset.before),after:ft(t.dataset.after)})}],toDOM:t=>["span",{class:`format-change user-${t.attrs.user}`,"data-user":t.attrs.user,"data-username":t.attrs.username,"data-date":t.attrs.date,"data-before":JSON.stringify(t.attrs.before),"data-after":JSON.stringify(t.attrs.after)}]},ht={attrs:{user:{default:0},username:{default:""},date:{default:0},approved:{default:!0}},inclusive:!1,group:"track",parseDOM:[{tag:"span.insertion",getAttrs:t=>({user:parseInt(t.dataset.user),username:t.dataset.username,date:parseInt(t.dataset.date),inline:!0,approved:!1})},{tag:"span.approved-insertion",getAttrs:t=>({user:parseInt(t.dataset.user),username:t.dataset.username,date:parseInt(t.dataset.date),inline:!0,approved:!0})}],toDOM:t=>["span",{class:t.attrs.approved?"approved-insertion":`insertion user-${t.attrs.user}`,"data-user":t.attrs.user,"data-username":t.attrs.username,"data-date":t.attrs.date}]},gt={group:"block",content:"inline*",attrs:{track:{default:[]}},parseDOM:[{tag:"p",getAttrs:t=>({track:dt(t.dataset.track)})}],toDOM:t=>["p",t.attrs.track&&t.attrs.track.length?{"data-track":JSON.stringify(t.attrs.track)}:{},0]},vt={content:"block+",group:"block",attrs:{track:{default:[]}},marks:"annotation",defining:!0,parseDOM:[{tag:"blockquote",getAttrs:t=>({track:dt(t.dataset.track)})}],toDOM:t=>["blockquote",t.attrs.track&&t.attrs.track.length?{"data-track":JSON.stringify(t.attrs.track)}:{},0]},yt={group:"block",attrs:{track:{default:[]}},parseDOM:[{tag:"hr",getAttrs:t=>({track:dt(t.dataset.track)})}],toDOM:t=>["hr",t.attrs.track&&t.attrs.track.length?{"data-track":JSON.stringify(t.attrs.track)}:{}]},kt={parseDOM:[{tag:"span.underline"}],toDOM:()=>["span",{class:"underline"},0]};function bt(t){if(!t)return[];let e;try{e=JSON.parse(t)}catch(a){return[]}return Array.isArray(e)?e.filter((t=>t.hasOwnProperty("id"))).map((t=>{const e={id:t.id};return t.locator&&(e.locator=t.locator),t.prefix&&(e.prefix=t.prefix),e})):[]}const wt={inline:!0,group:"inline",attrs:{format:{default:"autocite"},references:{default:[]}},parseDOM:[{tag:"span.citation",getAttrs:t=>({format:t.dataset.format||"",references:bt(t.dataset.references)})}],toDOM:t=>["span",{class:"citation","data-format":t.attrs.format,"data-references":JSON.stringify(t.attrs.references)}]};let Ot;const Mt={},_t=function(t,e){if(!e)return t();if(void 0===Ot){const t=document.createElement("link").relList;Ot=t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}return Promise.all(e.map((t=>{if(t in Mt)return;Mt[t]=!0;const e=t.endsWith(".css"),a=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${a}`))return;const r=document.createElement("link");return r.rel=e?"stylesheet":Ot,e||(r.as="script",r.crossOrigin=""),r.href=t,document.head.appendChild(r),e?new Promise(((t,e)=>{r.addEventListener("load",t),r.addEventListener("error",e)})):void 0}))).then((()=>t()))},At={inline:!0,group:"inline",attrs:{equation:{default:""}},parseDOM:[{tag:"span.equation",getAttrs:t=>({equation:t.dataset.equation})}],toDOM(t){const e=document.createElement("span");return e.dataset.equation=t.attrs.equation,e.classList.add("equation"),_t((()=>import("./mathlive.09904145.js")),void 0).then((a=>{e.innerHTML=a.convertLatexToMarkup(t.attrs.equation,{mathstyle:"textstyle"})})),e.setAttribute("contenteditable","false"),e}};let St=!1;const Dt={allowGapCursor:!1,selectable:!0,group:"block",attrs:{category:{default:"none"},caption:{default:!1},id:{default:!1},track:{default:[]},aligned:{default:"center"},width:{default:"100"}},content:"figure_caption image|figure_caption figure_equation|image figure_caption|figure_equation figure_caption",parseDOM:[{tag:"figure",getAttrs:t=>({category:t.dataset.category,caption:!!t.dataset.captionHidden,id:t.id,track:dt(t.dataset.track),aligned:t.dataset.aligned,width:t.dataset.width,diff:t.dataset.diff})}],toDOM(t){var e;const a={id:t.attrs.id,class:`aligned-${t.attrs.aligned} image-width-${t.attrs.width}`,"data-aligned":t.attrs.aligned,"data-width":t.attrs.width,"data-category":t.attrs.category};return t.attrs.caption||(a["data-caption-hidden"]=!0),(null==(e=t.attrs.track)?void 0:e.length)&&(a["data-track"]=JSON.stringify(t.attrs.track)),["figure",a,0]}},Et={selectable:!1,draggable:!1,attrs:{image:{default:!1}},parseDOM:[{tag:"img",getAttrs(t){const e=parseInt(t.dataset.image);return{image:!isNaN(e)&&e}}}],toDOM(t){var e;const a=document.createElement("img");if(!1!==t.attrs.image&&(a.dataset.image=t.attrs.image,t.type.schema.cached.imageDB))if(null==(e=t.type.schema.cached.imageDB.db[t.attrs.image])?void 0:e.image){const e=t.type.schema.cached.imageDB.db[t.attrs.image].image;a.setAttribute("src",e),a.dataset.imageSrc=t.type.schema.cached.imageDB.db[t.attrs.image].image}else St?a.setAttribute("src",`${settings_STATIC_URL}img/error.png?v=${transpile_VERSION}`):t.type.schema.cached.imageDB.getDB().then((()=>{var e;if(null==(e=t.type.schema.cached.imageDB.db[t.attrs.image])?void 0:e.image){const e=t.type.schema.cached.imageDB.db[t.attrs.image].image;a.setAttribute("src",e),a.dataset.imageSrc=t.type.schema.cached.imageDB.db[t.attrs.image].image}else St=!0}));return a}},Nt={selectable:!1,draggable:!1,attrs:{equation:{default:!1}},parseDOM:[{tag:"div.figure-equation[data-equation]",getAttrs:t=>({equation:t.dataset.equation})}],toDOM(t){const e=document.createElement("div");return e.dataset.equation=t.attrs.equation,e.classList.add("figure-equation"),!1!==t.attrs.equation&&_t((()=>import("./mathlive.09904145.js")),void 0).then((a=>{e.innerHTML=a.convertLatexToMarkup(t.attrs.equation,{mathstyle:"displaystyle"})})),e}},Tt={isolating:!0,defining:!0,content:"inline*",parseDOM:[{tag:"figcaption span.text"}],toDOM:()=>["figcaption",["span",{class:"label"}],["span",{class:"text"},0]]},xt=t=>({group:"block heading",content:"inline*",marks:"_",defining:!0,attrs:{id:{default:!1},track:{default:[]}},parseDOM:[{tag:`h${t}`,getAttrs:t=>({id:t.id,track:dt(t.dataset.track)})}],toDOM(e){const a={id:e.attrs.id};return ut(e,a),[`h${t}`,a,0]}}),Pt=xt(1),jt=xt(2),Bt=xt(3),It=xt(4),zt=xt(5),Lt=xt(6),Ct={group:"block",content:"list_item+",attrs:{id:{default:!1},order:{default:1},track:{default:[]}},parseDOM:[{tag:"ol",getAttrs:t=>({id:t.id,order:t.hasAttribute("start")?+t.getAttribute("start"):1,track:dt(t.dataset.track)})}],toDOM(t){const e={id:t.attrs.id};return 1!==t.attrs.order&&(e.start=t.attrs.order),ut(t,e),["ol",e,0]}},Rt={group:"block",content:"list_item+",attrs:{id:{default:!1},track:{default:[]}},parseDOM:[{tag:"ul",getAttrs:t=>({id:t.id,track:dt(t.dataset.track)})}],toDOM(t){const e={id:t.attrs.id};return ut(t,e),["ul",e,0]}},qt={content:"block+",marks:"annotation",attrs:{track:{default:[]}},parseDOM:[{tag:"li",getAttrs:t=>({track:dt(t.dataset.track)})}],toDOM(t){const e={};return ut(t,e),["li",e,0]},defining:!0};const Jt={inline:!0,group:"inline",attrs:{id:{default:!1},title:{default:null}},parseDOM:[{tag:"span.cross-reference[data-id][data-title]",getAttrs:t=>({id:t.dataset.id,title:t.dataset.title})}],toDOM:t=>["span",{class:"cross-reference"+(t.attrs.title?"":" missing-target"),"data-id":t.attrs.id,"data-title":t.attrs.title},t.attrs.title?t.attrs.title:void 0]},$t={attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title")})}],toDOM(t){const{href:e,title:a}=t.attrs;return["a",a||"#"!==e.charAt(0)?{href:e,title:a}:{href:e,title:void 0,class:"missing-target"},0]}},Ft={attrs:{id:{default:!1}},inclusive:!1,group:"annotation",parseDOM:[{tag:"span.anchor[data-id]",getAttrs:t=>({id:t.dataset.id})}],toDOM:t=>["span",{class:"anchor","data-id":t.attrs.id}]},Ut={inline:!1,group:"block",attrs:{id:{default:!1},track:{default:[]},width:{default:"100"},aligned:{default:"center"},layout:{default:"fixed"},category:{default:"none"},caption:{default:!1}},content:"table_caption table_body",parseDOM:[{tag:"table",getAttrs(t){const e=dt(t.dataset.track),a=t.dataset.width;return{track:e,width:a,aligned:"100"===a?"center":t.dataset.aligned,layout:t.dataset.layout,id:t.id||t.dataset.id,category:t.dataset.category,caption:!!t.dataset.captionHidden}}}],toDOM(t){const e={id:t.attrs.id,class:`table-${t.attrs.width} table-${t.attrs.aligned} table-${t.attrs.layout}`,"data-width":t.attrs.width,"data-aligned":t.attrs.aligned,"data-layout":t.attrs.layout,"data-category":t.attrs.category};return t.attrs.track.length&&(e["data-track"]=JSON.stringify(t.attrs.track)),t.attrs.caption||(e["data-caption-hidden"]=!0),["table",e,0]}},Vt={content:"inline*",parseDOM:[{tag:"caption span.text"}],toDOM:()=>["caption",["span",{class:"label"}],["span",{class:"text"},0]]},Ht=c({cellContent:"block+"}),Wt=Object.assign({},Ht.table,{parseDOM:[{tag:"tbody"}],toDOM:()=>["tbody",0]}),Gt={content:"(table_cell | table_header)+",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:()=>["tr",0]},Qt=Object.assign({marks:"annotation"},Ht.table_header),Zt=Object.assign({marks:"annotation"},Ht.table_cell),Yt={group:"part",selectable:!1,content:"(block|table_block)+",marks:"annotation",parseDOM:[{tag:"div.footnote-container"}],toDOM:t=>["div",{class:"footnote-container"},0]},Kt={nodes:l.from({doc:{content:"part*",selectable:!1},footnotecontainer:Yt,paragraph:gt,heading1:Pt,heading2:jt,heading3:Bt,heading4:It,heading5:zt,heading6:Lt,blockquote:vt,horizontal_rule:yt,figure:Dt,image:Et,figure_equation:Nt,figure_caption:Tt,text:d.text,hard_break:d.hard_break,citation:wt,equation:At,cross_reference:Jt,ordered_list:Ct,bullet_list:Rt,list_item:qt}),marks:l.from({em:u.em,strong:u.strong,link:$t,underline:kt,anchor:Ft,comment:lt,annotation_tag:ct,deletion:pt,insertion:ht,format_change:mt})};Kt.nodes=Kt.nodes.append(c({tableGroup:"table_block",cellContent:"block+"})),Kt.nodes=Kt.nodes.update("table",Object.assign({},Kt.nodes.get("table"),{attrs:{track:{default:[]}},parseDOM:[{tag:"table",getAttrs:t=>({track:t.dataset.track?JSON.parse(t.dataset.track):[]})}],toDOM(t){const e={};return t.attrs.track.length&&(e["data-track"]=JSON.stringify(t.attrs.track)),["table",e,["tbody",0]]}}));const Xt=new p(Kt),te=function(t){const e=document.createElement("div");e.classList.add("footnote-container"),e.innerHTML=t;return f.fromSchema(Xt).parse(e,{preserveWhitespace:!0,topNode:!1}).firstChild.toJSON().content},ee=function(t){const e=function(t){const e={type:"footnotecontainer",content:t};return m.fromJSON(Xt,e)}(t);return h.fromSchema(Xt).serializeNode(e).innerHTML};const ae={inline:!0,draggable:!0,attrs:{firstname:{default:!1},lastname:{default:!1},email:{default:!1},institution:{default:!1}},parseDOM:[{tag:"span.contributor",getAttrs:t=>({firstname:t.dataset.firstname,lastname:t.dataset.lastname,email:t.dataset.email,institution:t.dataset.institution})}],toDOM(t){const e=document.createElement("span");e.classList.add("contributor"),e.dataset.firstname=t.attrs.firstname,e.dataset.lastname=t.attrs.lastname,e.dataset.email=t.attrs.email,e.dataset.institution=t.attrs.institution;const a=[];return t.attrs.firstname&&a.push(it(t.attrs.firstname)),t.attrs.lastname&&a.push(it(t.attrs.lastname)),t.attrs.email&&a.push(`<i>undefined: ${it(t.attrs.email)}</i>`),t.attrs.institution&&a.push(`(${it(t.attrs.institution)})`),e.innerHTML=a.join(" "),e}},re={inline:!0,draggable:!0,attrs:{tag:{default:""}},parseDOM:[{tag:"span.tag",getAttrs:t=>({tag:t.innerText})}],toDOM:t=>["span",{class:"tag"},t.attrs.tag]},ne={inline:!0,group:"inline",attrs:{footnote:{default:[{type:"paragraph"}]}},parseDOM:[{tag:"span.footnote-marker[data-footnote]",getAttrs:t=>({footnote:te(t.dataset.footnote)})}],toDOM(t){const e=document.createElement("span");return e.classList.add("footnote-marker"),e.dataset.footnote=ee(t.attrs.footnote),e.innerHTML="&nbsp;",e}},oe={content:"text*",marks:"_",group:"block",code:!0,defining:!0,attrs:{track:{default:[]}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:t=>({track:dt(t.dataset.track)})}],toDOM:t=>["pre",t.attrs.track.length?{"data-track":JSON.stringify(t.attrs.track)}:{},["code",0]]},ie={defining:!0,content:"title part*",selectable:!1,allowGapCursor:!1,attrs:{documentstyle:{default:""},tracked:{default:!1},citationstyle:{default:"apa"},citationstyles:{default:["american-anthropological-association","apa","chicago-author-date","chicago-note-bibliography","harvard-cite-them-right","modern-language-association","nature","oxford-university-press-humsoc"]},language:{default:"en-US"},languages:{default:["af-ZA","sq-AL","ar","ast","be","br","bg","ca","ca-ES-Valencia","zh-CN","da","nl","en-AU","en-CA","en-NZ","en-ZA","en-GB","en-US","eo","fr","gl","de-DE","de-AU","de-CH","el","he","is","it","ja","km","lt","ml","nb-NO","nn-NO","fa","pl","pt-BR","pt-PT","ro","ru","tr","sr-SP-Cy","sr-SP-Lt","sk","sl","es","sv","ta","tl","uk"]},papersize:{default:"A4"},papersizes:{default:["A4","US Letter"]},footnote_marks:{default:["strong","em","link"]},footnote_elements:{default:["paragraph","heading1","heading2","heading3","heading4","heading5","heading6","figure","ordered_list","bullet_list","horizontal_rule","equation","citation","cross_reference","blockquote","table"]},bibliography_header:{default:{}},template:{default:""},import_id:{default:""},copyright:{default:{holder:!1,year:!1,freeToRead:!0,licenses:[]}}},parseDOM:[{tag:"div.article",getAttrs:t=>({papersize:t.dataset.papersize,citationstyle:t.dataset.citationstyle,documentstyle:t.dataset.documentstyle})}],toDOM:t=>["div",{class:"article","data-papersize":t.attrs.papersize,"data-citationstyle":t.attrs.citationstyle,"data-documentstyle":t.attrs.documentstyle},0]},se=(t,e,a={})=>({content:e,group:"part",marks:"annotation track",isolating:!0,attrs:Object.assign({title:{default:""},id:{default:""},locking:{default:!1},language:{default:!1},optional:{default:!1},hidden:{default:!1},help:{default:!1},initial:{default:!1},deleted:{default:!1}},a),parseDOM:[{tag:`div.article-${t}`,getAttrs:t=>({hidden:"true"===t.dataset.hidden})}],toDOM(e){const a={class:`article-part article-${t} article-${e.attrs.id}`};return e.attrs.hidden&&(a["data-hidden"]="true"),e.attrs.deleted&&(a.class+=" article-deleted"),["div",a,0]}}),ce=se("richtext","block+",{elements:{default:["paragraph","heading1","heading2","heading3","heading4","heading5","heading6","code_block","figure","ordered_list","bullet_list","horizontal_rule","equation","citation","cross_reference","blockquote","footnote","table"]},marks:{default:["strong","em","link","anchor"]},metadata:{default:!1}}),le=se("heading","heading",{elements:{default:["heading1"]},marks:{default:["strong","em","link","anchor"]},metadata:{default:!1}}),de=se("contributors","contributor*",{item_title:{default:"Contributor"},metadata:{default:!1}}),ue=se("tags","tag*",{item_title:{default:"Tag"},metadata:{default:!1}}),pe=se("table","table",{elements:{default:["paragraph","heading1","heading2","heading3","heading4","heading5","heading6","figure","ordered_list","bullet_list","horizontal_rule","equation","citation","blockquote","footnote"]},marks:{default:["strong","em","link","anchor"]}}),fe={group:"part",marks:"annotation track",defining:!0,parseDOM:[{tag:"div.table-of-contents"}],attrs:{title:{default:"Table of Contents"},id:{default:"toc"},optional:{default:!1},hidden:{default:!1}},toDOM(t){const e=document.createElement("div");return e.classList.add("article-part","table-of-contents"),t.attrs.hidden&&(e.dataset.hidden="true"),e.innerHTML=`<h1 class="toc">${t.attrs.title}</h1>`,e}},me={marks:"annotation track",group:"part",defining:!0,attrs:{id:{default:"separator"}},parseDOM:[{tag:"hr.article-separator_part"}],toDOM(t){const e=document.createElement("hr");return e.classList.add("article-separator_part"),e.classList.add(`article-${t.attrs.id}`),e}},he={content:"text*",marks:"annotation track",group:"fixedpart",defining:!0,isolating:!0,attrs:{id:{default:"title"}},parseDOM:[{tag:"div.article-title"}],toDOM:t=>["div",{class:"article-part article-title"},0]},ge={nodes:l.from({doc:{content:"article",selectable:!1},article:ie,richtext_part:ce,heading_part:le,contributors_part:de,tags_part:ue,table_part:pe,table_of_contents:fe,separator_part:me,title:he,contributor:ae,tag:re,paragraph:gt,blockquote:vt,horizontal_rule:yt,figure:Dt,image:Et,figure_equation:Nt,figure_caption:Tt,heading1:Pt,heading2:jt,heading3:Bt,heading4:It,heading5:zt,heading6:Lt,code_block:oe,text:d.text,hard_break:d.hard_break,citation:wt,equation:At,cross_reference:Jt,footnote:ne,ordered_list:Ct,bullet_list:Rt,list_item:qt,table:Ut,table_caption:Vt,table_body:Wt,table_row:Gt,table_cell:Zt,table_header:Qt}),marks:l.from({em:u.em,strong:u.strong,link:$t,underline:kt,comment:lt,annotation_tag:ct,anchor:Ft,deletion:pt,insertion:ht,format_change:mt})},ve=new p(ge),ye={inline:!0,group:"inline",attrs:{name:{default:""},id:{default:0}},parseDOM:[{tag:"span.collaborator",getAttrs:t=>({username:t.dataset.name,id:parseInt(t.dataset.id)})}],toDOM:t=>["span",{class:"collaborator","data-name":t.attrs.name,"data-id":t.attrs.id},t.attrs.name]};new p({nodes:{doc:{content:"block+",toDOM:t=>["div",0]},paragraph:d.paragraph,text:d.text,collaborator:ye},marks:{}}),new g("accessRights");var ke={},be={};function we(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Oe(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(be,"__esModule",{value:!0}),be.Pointer=void 0;var Me=function(){function t(t){void 0===t&&(t=[""]),this.tokens=t}return t.fromJSON=function(e){var a=e.split("/").map(we);if(""!==a[0])throw new Error("Invalid JSON Pointer: "+e);return new t(a)},t.prototype.toString=function(){return this.tokens.map(Oe).join("/")},t.prototype.evaluate=function(t){for(var e=null,a="",r=t,n=1,o=this.tokens.length;n<o;n++)r=((e=r)||{})[a=this.tokens[n]];return{parent:e,key:a,value:r}},t.prototype.get=function(t){return this.evaluate(t).value},t.prototype.set=function(t,e){for(var a=t,r=1,n=this.tokens.length-1,o=this.tokens[r];r<n;r++)a=(a||{})[o];a&&(a[this.tokens[this.tokens.length-1]]=e)},t.prototype.push=function(t){this.tokens.push(t)},t.prototype.add=function(e){return new t(this.tokens.concat(String(e)))},t}();be.Pointer=Me;var _e,Ae={},Se={};_e=Se,Object.defineProperty(_e,"__esModule",{value:!0}),_e.clone=_e.objectType=_e.hasOwnProperty=void 0,_e.hasOwnProperty=Object.prototype.hasOwnProperty,_e.objectType=function(t){return void 0===t?"undefined":null===t?"null":Array.isArray(t)?"array":typeof t},_e.clone=function t(e){if(null==(a=e)||"object"!=typeof a)return e;var a;if(e.constructor==Array){for(var r=e.length,n=new Array(r),o=0;o<r;o++)n[o]=t(e[o]);return n}if(e.constructor==Date)return new Date(+e);var i={};for(var s in e)_e.hasOwnProperty.call(e,s)&&(i[s]=t(e[s]));return i};var De={};Object.defineProperty(De,"__esModule",{value:!0}),De.diffAny=De.diffObjects=De.diffArrays=De.intersection=De.subtract=De.isDestructive=void 0;var Ee=be,Ne=Se;function Te(t,e){var a={};for(var r in t)Ne.hasOwnProperty.call(t,r)&&void 0!==t[r]&&(a[r]=1);for(var n in e)Ne.hasOwnProperty.call(e,n)&&void 0!==e[n]&&delete a[n];return Object.keys(a)}function xe(t){for(var e=t.length,a={},r=0;r<e;r++){var n=t[r];for(var o in n)Ne.hasOwnProperty.call(n,o)&&void 0!==n[o]&&(a[o]=(a[o]||0)+1)}for(var o in a)a[o]<e&&delete a[o];return Object.keys(a)}function Pe(t,e){return{operations:t.operations.concat(e),cost:t.cost+1}}function je(t,e,a,r){void 0===r&&(r=Ie);var n={"0,0":{operations:[],cost:0}};var o=isNaN(t.length)||t.length<=0?0:t.length,i=isNaN(e.length)||e.length<=0?0:e.length;return function a(o,i){var s=o+","+i,c=n[s];if(void 0===c){if(o>0&&i>0&&!r(t[o-1],e[i-1],new Ee.Pointer).length)c=a(o-1,i-1);else{var l=[];if(o>0){var d=a(o-1,i),u={op:"remove",index:o-1};l.push(Pe(d,u))}if(i>0){var p=a(o,i-1),f={op:"add",index:o-1,value:e[i-1]};l.push(Pe(p,f))}if(o>0&&i>0){var m=a(o-1,i-1),h={op:"replace",index:o-1,original:t[o-1],value:e[i-1]};l.push(Pe(m,h))}c=l.sort((function(t,e){return t.cost-e.cost}))[0]}n[s]=c}return c}(o,i).operations.reduce((function(t,e){var n=t[0],i=t[1];if(function(t){return"add"===t.op}(e)){var s=e.index+1+i,c=s<o+i?String(s):"-",l={op:e.op,path:a.add(c).toString(),value:e.value};return[n.concat(l),i+1]}if(function(t){return"remove"===t.op}(e)){l={op:e.op,path:a.add(String(e.index+i)).toString()};return[n.concat(l),i-1]}var d=a.add(String(e.index+i)),u=r(e.original,e.value,d);return[n.concat.apply(n,u),i]}),[[],0])[0]}function Be(t,e,a,r){void 0===r&&(r=Ie);var n=[];return Te(t,e).forEach((function(t){n.push({op:"remove",path:a.add(t).toString()})})),Te(e,t).forEach((function(t){n.push({op:"add",path:a.add(t).toString(),value:e[t]})})),xe([t,e]).forEach((function(o){n.push.apply(n,r(t[o],e[o],a.add(o)))})),n}function Ie(t,e,a,r){if(void 0===r&&(r=Ie),t===e)return[];var n=Ne.objectType(t),o=Ne.objectType(e);return"array"==n&&"array"==o?je(t,e,a,r):"object"==n&&"object"==o?Be(t,e,a,r):[{op:"replace",path:a.toString(),value:e}]}De.isDestructive=function(t){var e=t.op;return"remove"===e||"replace"===e||"copy"===e||"move"===e},De.subtract=Te,De.intersection=xe,De.diffArrays=je,De.diffObjects=Be,De.diffAny=Ie;var ze,Le=v&&v.__extends||(ze=function(t,e){return(ze=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}ze(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)});Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.apply=Ae.InvalidOperationError=Ae.test=Ae.copy=Ae.move=Ae.replace=Ae.remove=Ae.add=Ae.TestError=Ae.MissingError=void 0;var Ce=be,Re=Se,qe=De,Je=function(t){function e(e){var a=t.call(this,"Value required at path: "+e)||this;return a.path=e,a.name="MissingError",a}return Le(e,t),e}(Error);Ae.MissingError=Je;var $e=function(t){function e(e,a){var r=t.call(this,"Test failed: "+e+" != "+a)||this;return r.actual=e,r.expected=a,r.name="TestError",r}return Le(e,t),e}(Error);function Fe(t,e,a){if(Array.isArray(t))if("-"==e)t.push(a);else{var r=parseInt(e,10);t.splice(r,0,a)}else t[e]=a}function Ue(t,e){if(Array.isArray(t)){var a=parseInt(e,10);t.splice(a,1)}else delete t[e]}function Ve(t,e){var a=Ce.Pointer.fromJSON(e.path).evaluate(t);return void 0===a.parent?new Je(e.path):(Fe(a.parent,a.key,Re.clone(e.value)),null)}function He(t,e){var a=Ce.Pointer.fromJSON(e.path).evaluate(t);return void 0===a.value?new Je(e.path):(Ue(a.parent,a.key),null)}function We(t,e){var a=Ce.Pointer.fromJSON(e.path).evaluate(t);if(null===a.parent)return new Je(e.path);if(Array.isArray(a.parent)){if(parseInt(a.key,10)>=a.parent.length)return new Je(e.path)}else if(void 0===a.value)return new Je(e.path);return a.parent[a.key]=e.value,null}function Ge(t,e){var a=Ce.Pointer.fromJSON(e.from).evaluate(t);if(void 0===a.value)return new Je(e.from);var r=Ce.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new Je(e.path):(Ue(a.parent,a.key),Fe(r.parent,r.key,a.value),null)}function Qe(t,e){var a=Ce.Pointer.fromJSON(e.from).evaluate(t);if(void 0===a.value)return new Je(e.from);var r=Ce.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new Je(e.path):(Fe(r.parent,r.key,Re.clone(a.value)),null)}function Ze(t,e){var a=Ce.Pointer.fromJSON(e.path).evaluate(t);return qe.diffAny(a.value,e.value,new Ce.Pointer).length?new $e(a.value,e.value):null}Ae.TestError=$e,Ae.add=Ve,Ae.remove=He,Ae.replace=We,Ae.move=Ge,Ae.copy=Qe,Ae.test=Ze;var Ye=function(t){function e(e){var a=t.call(this,"Invalid operation: "+e.op)||this;return a.operation=e,a.name="InvalidOperationError",a}return Le(e,t),e}(Error);Ae.InvalidOperationError=Ye,Ae.apply=function(t,e){switch(e.op){case"add":return Ve(t,e);case"remove":return He(t,e);case"replace":return We(t,e);case"move":return Ge(t,e);case"copy":return Qe(t,e);case"test":return Ze(t,e)}return new Ye(e)},Object.defineProperty(ke,"__esModule",{value:!0}),ke.createTests=ke.createPatch=ke.applyPatch=void 0;var Ke=be,Xe=Ae,ta=De;function ea(t,e){var a=Ke.Pointer.fromJSON(e).evaluate(t);if(void 0!==a)return{op:"test",path:e,value:a.value}}function aa(){}function ra(t,e,a,r,n){for(var o=0,i=e.length,s=0,c=0;o<i;o++){var l=e[o];if(l.removed){if(l.value=t.join(r.slice(c,c+l.count)),c+=l.count,o&&e[o-1].added){var d=e[o-1];e[o-1]=e[o],e[o]=d}}else{if(!l.added&&n){var u=a.slice(s,s+l.count);u=u.map((function(t,e){var a=r[c+e];return a.length>t.length?a:t})),l.value=t.join(u)}else l.value=t.join(a.slice(s,s+l.count));s+=l.count,l.added||(c+=l.count)}}var p=e[i-1];return i>1&&"string"==typeof p.value&&(p.added||p.removed)&&t.equals("",p.value)&&(e[i-2].value+=p.value,e.pop()),e}function na(t){return{newPos:t.newPos,components:t.components.slice(0)}}ke.applyPatch=function(t,e){return e.map((function(e){return Xe.apply(t,e)}))},ke.createPatch=function(t,e,a){var r=new Ke.Pointer;return(a?function(t){return function e(a,r,n){var o=t(a,r,n);return Array.isArray(o)?o:ta.diffAny(a,r,n,e)}}(a):ta.diffAny)(t,e,r)},ke.createTests=function(t,e){var a=new Array;return e.filter(ta.isDestructive).forEach((function(e){var r=ea(t,e.path);if(r&&a.push(r),"from"in e){var n=ea(t,e.from);n&&a.push(n)}})),a},aa.prototype={diff:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=a.callback;"function"==typeof a&&(r=a,a={}),this.options=a;var n=this;function o(t){return r?(setTimeout((function(){r(void 0,t)}),0),!0):t}t=this.castInput(t),e=this.castInput(e),t=this.removeEmpty(this.tokenize(t));var i=(e=this.removeEmpty(this.tokenize(e))).length,s=t.length,c=1,l=i+s,d=[{newPos:-1,components:[]}],u=this.extractCommon(d[0],e,t,0);if(d[0].newPos+1>=i&&u+1>=s)return o([{value:this.join(e),count:e.length}]);function p(){for(var a=-1*c;a<=c;a+=2){var r=void 0,l=d[a-1],u=d[a+1],p=(u?u.newPos:0)-a;l&&(d[a-1]=void 0);var f=l&&l.newPos+1<i,m=u&&0<=p&&p<s;if(f||m){if(!f||m&&l.newPos<u.newPos?(r=na(u),n.pushComponent(r.components,void 0,!0)):((r=l).newPos++,n.pushComponent(r.components,!0,void 0)),p=n.extractCommon(r,e,t,a),r.newPos+1>=i&&p+1>=s)return o(ra(n,r.components,e,t,n.useLongestToken));d[a]=r}else d[a]=void 0}c++}if(r)!function t(){setTimeout((function(){if(c>l)return r();p()||t()}),0)}();else for(;c<=l;){var f=p();if(f)return f}},pushComponent:function(t,e,a){var r=t[t.length-1];r&&r.added===e&&r.removed===a?t[t.length-1]={count:r.count+1,added:e,removed:a}:t.push({count:1,added:e,removed:a})},extractCommon:function(t,e,a,r){for(var n=e.length,o=a.length,i=t.newPos,s=i-r,c=0;i+1<n&&s+1<o&&this.equals(e[i+1],a[s+1]);)i++,s++,c++;return c&&t.components.push({count:c}),t.newPos=i,s},equals:function(t,e){return this.options.comparator?this.options.comparator(t,e):t===e||this.options.ignoreCase&&t.toLowerCase()===e.toLowerCase()},removeEmpty:function(t){for(var e=[],a=0;a<t.length;a++)t[a]&&e.push(t[a]);return e},castInput:function(t){return t},tokenize:function(t){return t.split("")},join:function(t){return t.join("")}};var oa=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,ia=/\S/,sa=new aa;sa.equals=function(t,e){return this.options.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t===e||this.options.ignoreWhitespace&&!ia.test(t)&&!ia.test(e)},sa.tokenize=function(t){for(var e=t.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),a=0;a<e.length-1;a++)!e[a+1]&&e[a+2]&&oa.test(e[a])&&oa.test(e[a+2])&&(e[a]+=e[a+2],e.splice(a+1,2),a--);return e};var ca=new aa;function la(t){return(la="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}ca.tokenize=function(t){var e=[],a=t.split(/(\n|\r\n)/);a[a.length-1]||a.pop();for(var r=0;r<a.length;r++){var n=a[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e},(new aa).tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)},(new aa).tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};var da=Object.prototype.toString,ua=new aa;function pa(t,e,a,r,n){var o,i;for(e=e||[],a=a||[],r&&(t=r(n,t)),o=0;o<e.length;o+=1)if(e[o]===t)return a[o];if("[object Array]"===da.call(t)){for(e.push(t),i=new Array(t.length),a.push(i),o=0;o<t.length;o+=1)i[o]=pa(t[o],e,a,r,n);return e.pop(),a.pop(),i}if(t&&t.toJSON&&(t=t.toJSON()),"object"===la(t)&&null!==t){e.push(t),i={},a.push(i);var s,c=[];for(s in t)t.hasOwnProperty(s)&&c.push(s);for(c.sort(),o=0;o<c.length;o+=1)i[s=c[o]]=pa(t[s],e,a,r,s);e.pop(),a.pop()}else i=t;return i}ua.useLongestToken=!0,ua.tokenize=ca.tokenize,ua.castInput=function(t){var e=this.options,a=e.undefinedReplacement,r=e.stringifyReplacer,n=void 0===r?function(t,e){return void 0===e?a:e}:r;return"string"==typeof t?t:JSON.stringify(pa(t,null,null,n),n,"  ")},ua.equals=function(t,e){return aa.prototype.equals.call(ua,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};var fa=new aa;function ma(t,e,a,r){for(var n=0,o=0;n<t.childCount;n++){var i=t.child(n),s=o+i.nodeSize,c=Math.max(o,e),l=Math.min(s,a);if(c<l)if(i.isText)for(var d=c;d<l;d++)r.push(i.text.charCodeAt(d-o));else i.isLeaf?r.push(i.type.name):(c==o&&r.push(i.type.name),ma(i.content,Math.max(o+1,c)-o-1,Math.min(s-1,l)-o-1,r),l==s&&r.push(-1));o=s}return r}fa.tokenize=function(t){return t.slice()},fa.join=fa.removeEmpty=function(t){return t};function ha(t,e,a){for(var r=ma(t,a.fromA,a.toA,[]),n=ma(e,a.fromB,a.toB,[]),o=0,i=r.length,s=n.length;o<r.length&&o<n.length&&r[o]===n[o];)o++;if(o==r.length&&o==n.length)return[];for(;i>o&&s>o&&r[i-1]===n[s-1];)i--,s--;if(i==o||s==o||i==s&&i==o+1)return[a.slice(o,i,o,s)];for(var c,l,d=i-o,u=s-o,p=Math.min(5e3,d+u),f=[],m=[],h=2*(p+1),g=0;g<h;g++)m[g]=-1;for(var v=0;v<=p;v++){for(var y=-v;y<=v;y+=2){for(var k=m[y+1+p],b=m[y-1+p],w=k<b?b:k+1,O=w+y;w<d&&O<u&&r[o+w]===n[o+O];)w++,O++;if(m[y+p]=w,w>=d&&O>=u){for(var M=[],_=(c=i-o,l=s-o,Math.min(15,Math.max(2,Math.floor(Math.max(c,l)/10)))),A=-1,S=-1,D=-1,E=-1,N=function(t,e,r,n){A>-1&&A<e+_?(A=t,D=r):(A>-1&&M.push(a.slice(A,S,D,E)),A=t,S=e,D=r,E=n)},T=v-1;T>=0;T--){var x=m[y+1+p],P=m[y-1+p];x<P?N(w=P+o,w,O=w+--y,O+1):N(w=x+o,w+1,O=w+ ++y,O),m=f[T>>1]}return A>-1&&M.push(a.slice(A,S,D,E)),M.reverse()}}v%2==0&&f.push(m.slice())}return[a.slice(o,i,o,s)]}var ga=function(t,e){this.length=t,this.data=e};ga.prototype.cut=function(t){return t==this.length?this:new ga(t,this.data)},ga.slice=function(t,e,a){if(e==a)return ga.none;if(0==e&&a==ga.len(t))return t;for(var r=[],n=0,o=0;o<a;n++){var i=t[n],s=o+i.length,c=Math.min(a,s)-Math.max(e,o);c>0&&r.push(i.cut(c)),o=s}return r},ga.join=function(t,e,a){if(0==t.length)return e;if(0==e.length)return t;var r=a(t[t.length-1].data,e[0].data);if(null==r)return t.concat(e);var n=t.slice(0,t.length-1);n.push(new ga(t[t.length-1].length+e[0].length,r));for(var o=1;o<e.length;o++)n.push(e[o]);return n},ga.len=function(t){for(var e=0,a=0;a<t.length;a++)e+=t[a].length;return e},ga.none=[];var va=function(t,e,a,r,n,o){this.fromA=t,this.toA=e,this.fromB=a,this.toB=r,this.deleted=n,this.inserted=o},ya={lenA:{configurable:!0},lenB:{configurable:!0}};ya.lenA.get=function(){return this.toA-this.fromA},ya.lenB.get=function(){return this.toB-this.fromB},va.prototype.slice=function(t,e,a,r){return 0==t&&0==a&&e==this.toA-this.fromA&&r==this.toB-this.fromB?this:new va(this.fromA+t,this.fromA+e,this.fromB+a,this.fromB+r,ga.slice(this.deleted,t,e),ga.slice(this.inserted,a,r))},va.merge=function(t,e,a){if(0==t.length)return e;if(0==e.length)return t;for(var r=[],n=0,o=0,i=t[0],s=e[0];;){if(!i&&!s)return r;if(i&&(!s||i.toB<s.fromA)){var c=o?e[o-1].toB-e[o-1].toA:0;r.push(0==c?i:new va(i.fromA,i.toA,i.fromB+c,i.toB+c,i.deleted,i.inserted)),i=n++==t.length?null:t[n]}else if(s&&(!i||s.toA<i.fromB)){var l=n?t[n-1].toB-t[n-1].toA:0;r.push(0==l?s:new va(s.fromA-l,s.toA-l,s.fromB,s.toB,s.deleted,s.inserted)),s=o++==e.length?null:e[o]}else{for(var d=Math.min(i.fromB,s.fromA),u=Math.min(i.fromA,s.fromA-(n?t[n-1].toB-t[n-1].toA:0)),p=u,f=Math.min(s.fromB,i.fromB+(o?e[o-1].toB-e[o-1].toA:0)),m=f,h=ga.none,g=ga.none,v=!1,y=!1;;){var k=i?d>=i.fromB?i.toB:i.fromB:2e8,b=s?d>=s.fromA?s.toA:s.fromA:2e8,w=Math.min(k,b),O=i&&d>=i.fromB,M=s&&d>=s.fromA;if(!O&&!M)break;O&&d==i.fromB&&!v&&(h=ga.join(h,i.deleted,a),p+=i.lenA,v=!0),O&&!M&&(g=ga.join(g,ga.slice(i.inserted,d-i.fromB,w-i.fromB),a),m+=w-d),M&&d==s.fromA&&!y&&(g=ga.join(g,s.inserted,a),m+=s.lenB,y=!0),M&&!O&&(h=ga.join(h,ga.slice(s.deleted,d-s.fromA,w-s.fromA),a),p+=w-d),O&&w==i.toB&&(i=n++==t.length?null:t[n],v=!1),M&&w==s.toA&&(s=o++==e.length?null:e[o],y=!1),d=w}(u<p||f<m)&&r.push(new va(u,p,f,m,h,g))}}},Object.defineProperties(va.prototype,ya);try{new RegExp("[\\p{Alphabetic}_]","u")}catch(xr){}var ka=function(t,e){this.config=t,this.changes=e},ba={startDoc:{configurable:!0}};function wa(t,e,a,r){if(void 0===a&&(a=0),void 0===r&&(r=t.length),r==a+1)return[t[a]];var n=a+r>>1;return va.merge(wa(t,e,a,n),wa(t,e,n,r),e)}function Oa(t){for(var e=2e8,a=-2e8,r=0;r<t.length;r++){var n=t[r];2e8!=e&&(e=n.map(e,-1),a=n.map(a,1)),n.forEach((function(t,r,n,o){e=Math.min(e,n),a=Math.max(a,o)}))}return 2e8==e?null:{from:e,to:a}}function Ma(t,e,a){return a(t.fromB)==e.fromB&&a(t.toB)==e.toB&&_a(t.deleted,e.deleted)&&_a(t.inserted,e.inserted)}function _a(t,e){if(t.length!=e.length)return!1;for(var a=0;a<t.length;a++)if(t[a].length!=e[a].length||t[a].data!==e[a].data)return!1;return!0}ka.prototype.addSteps=function(t,e,a){for(var r=this,n=[],o=function(t){var r=Array.isArray(a)?a[t]:a,o=0;e[t].forEach((function(t,e,a,i){n.push(new va(t+o,e+o,a,i,t==e?ga.none:[new ga(e-t,r)],a==i?ga.none:[new ga(i-a,r)])),o=i-a-(e-t)}))},i=0;i<e.length;i++)o(i);if(0==n.length)return this;for(var s=wa(n,this.config.combine),c=va.merge(this.changes,s,this.config.combine),l=function(e){var a=c[e];if(a.fromA!=a.toA&&a.fromB!=a.toB&&s.some((function(t){return t.toB>a.fromB&&t.fromB<a.toB}))){var n=ha(r.config.doc.content,t.content,a);1==n.length&&0==n[0].fromB&&n[0].toB==a.toB-a.fromB||(1==n.length?c[e]=n[0]:(c.splice.apply(c,[e,1].concat(n)),e+=n.length-1),d=e)}},d=0;d<c.length;d++)l(d);return new ka(this.config,c)},ba.startDoc.get=function(){return this.config.doc},ka.prototype.map=function(t){return new ka(this.config,this.changes.map((function(e){var a=t(e);return a===e.data?e:new va(e.fromA,e.toA,e.fromB,e.toB,a)})))},ka.prototype.changedRange=function(t,e){if(t==this)return null;var a=e&&function(t){var e=Oa(t);if(!e)return null;var a=Oa(t.map((function(t){return t.invert()})).reverse());return{fromA:a.from,toA:a.to,fromB:e.from,toB:e.to}}(e),r=a?a.toB-a.fromB-(a.toA-a.fromA):0;function n(t){return!a||t<=a.fromA?t:t+r}var o=a?a.fromB:2e8,i=a?a.toB:-2e8;function s(t,e){void 0===e&&(e=t),o=Math.min(t,o),i=Math.max(e,i)}for(var c=this.changes,l=t.changes,d=0,u=0;d<c.length&&u<l.length;){var p=c[d],f=l[u];p&&f&&Ma(p,f,n)?(d++,u++):f&&(!p||n(p.fromB)>=f.fromB)?(s(f.fromB,f.toB),u++):(s(n(p.fromB),n(p.toB)),d++)}return o<=i?{from:o,to:i}:null},ka.create=function(t,e){return void 0===e&&(e=function(t,e){return t===e?t:null}),new ka({combine:e,doc:t},[],[])},Object.defineProperties(ka.prototype,ba),ka.computeDiff=ha;const Aa="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),Sa=y(k,b,w),Da=(t,e)=>t.setMeta("inputType",e);function Ea(t,e={}){return function(a,r){const{from:n,to:o}=a.selection,i=a.tr;return a.doc.nodesBetween(n,o,((r,n)=>{if(!r.isTextblock||r.hasMarkup(t,e))return;let o=!1;if(r.type==t)o=!0;else{const e=a.doc.resolve(n),r=e.index();o=e.parent.canReplaceWith(r,r+1,t)}o&&i.setBlockType(n,n+r.nodeSize,t,Object.assign({},r.attrs,e))})),!!i.steps.length&&(r&&r(i.scrollIntoView()),!0)}}const Na=Object.assign({},wt);Na.toDOM=function(t){const e=t.type.schema.cached.bibDB,a={};return t.attrs.references.forEach((t=>a[t.id]=e.db[t.id])),["span",{class:"citation","data-format":t.attrs.format,"data-references":JSON.stringify(t.attrs.references),"data-bibs":JSON.stringify(a)}]},new p({marks:Xt.spec.marks,nodes:Xt.spec.nodes.update("citation",Na)}),new g("clipboard"),new g("mergeDiff");const Ta={content:"block+",toDOM:t=>["div",0]},xa=new p({nodes:_.spec.nodes.remove("code_block").remove("image").remove("heading").remove("horizontal_rule").update("doc",Ta),marks:_.spec.marks.remove("code").update("link",{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),title:t.getAttribute("title")})}],toDOM:t=>["a",Object.assign({target:"_blank"},t.attrs),0]})});A(xa).fullMenu.splice(1,1),h.fromSchema(xa);const Pa=new p({nodes:ve.spec.nodes.update("doc",{content:"richtext_part"}),marks:ve.spec.marks}),ja=A(Pa).fullMenu;for(let Pr=1;Pr<=6;Pr++){const t=Pa.nodes[`heading${Pr}`];ja[1][1].content.push(S(t,{title:void 0+Pr,label:void 0+Pr}))}const Ba=Pa.nodes.table;ja[1][0].content.push(S(Ba,{title:void 0,label:void 0,enable:t=>!function(t){const e=t.selection.$head;for(let a=e.depth;a>0;a--)if("table"==e.node(a).type.spec.tableRole)return e.node(a);return!1}(t),run(t,e){const a=t.schema;e(t.tr.replaceSelectionWith(a.nodeFromJSON({type:"table",content:[{type:"table_caption"},{type:"table_body",content:[{type:"table_row",content:[{type:"table_cell",content:[{type:"paragraph"}]}]}]}]})))}}));const Ia=new p({nodes:ve.spec.nodes.update("doc",{content:"table_part"}).update("table_row",{content:"(table_cell | table_header)+",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:()=>["tr",0]}),marks:ve.spec.marks}),za=A(Ia).fullMenu;for(let Pr=1;Pr<=6;Pr++){const t=Ia.nodes[`heading${Pr}`];za[1][1].content.push(S(t,{title:void 0+Pr,label:void 0+Pr}))}function La(t,e){return new E({label:t,select:e,run:e})}const Ca=[La(void 0,T),La(void 0,N),La(void 0,T),La(void 0,x),La(void 0,P),La(void 0,j),La(void 0,B),La(void 0,I),La(void 0,z),La(void 0,L),La(void 0,C),La(void 0,R),La(void 0,((t,e)=>{const a=t.selection.$anchor;for(let r=a.depth;r>0;r--){if("table"==a.node(r).type.name)return e&&e(t.tr.delete(a.before(r),a.after(r)).scrollIntoView()),!0}return!1}))];za.splice(2,0,[new D(Ca,{label:void 0})]),ja.splice(2,0,[new D(Ca,{label:void 0})]);const Ra=new p({nodes:ve.spec.nodes.update("doc",{content:"heading_part"}).remove("horizontal_rule").remove("paragraph").remove("code_block"),marks:ve.spec.marks}),qa=A(Ra).fullMenu;for(let Pr=1;Pr<=6;Pr++){const t=Ra.nodes[`heading${Pr}`];qa[1][1].content.push(S(t,{title:void 0+Pr,label:void 0+Pr}))}new p({nodes:{doc:{content:"tags_part"},tags_part:ve.spec.nodes.get("tags_part"),tag:ve.spec.nodes.get("tag"),text:ve.spec.nodes.get("text")},marks:ve.spec.marks}),new p({nodes:{doc:{content:"contributors_part"},contributors_part:ve.spec.nodes.get("contributors_part"),contributor:ve.spec.nodes.get("contributor"),text:ve.spec.nodes.get("text")},marks:ve.spec.marks});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */
var Ja=function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function r(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),$a=Object.prototype.hasOwnProperty;function Fa(t,e){return $a.call(t,e)}function Ua(t){if(Array.isArray(t)){for(var e=new Array(t.length),a=0;a<e.length;a++)e[a]=""+a;return e}if(Object.keys)return Object.keys(t);e=[];for(var r in t)Fa(t,r)&&e.push(r);return e}function Va(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Ha(t){for(var e,a=0,r=t.length;a<r;){if(!((e=t.charCodeAt(a))>=48&&e<=57))return!1;a++}return!0}function Wa(t){return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function Ga(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Qa(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var e=0,a=t.length;e<a;e++)if(Qa(t[e]))return!0}else if("object"==typeof t){var r=Ua(t),n=r.length;for(e=0;e<n;e++)if(Qa(t[r[e]]))return!0}return!1}function Za(t,e){var a=[t];for(var r in e){var n="object"==typeof e[r]?JSON.stringify(e[r],null,2):e[r];void 0!==n&&a.push(r+": "+n)}return a.join("\n")}var Ya=function(t){function e(e,a,r,n,o){var i=this.constructor,s=t.call(this,Za(e,{name:a,index:r,operation:n,tree:o}))||this;return s.name=a,s.index=r,s.operation=n,s.tree=o,Object.setPrototypeOf(s,i.prototype),s.message=Za(e,{name:a,index:r,operation:n,tree:o}),s}return Ja(e,t),e}(Error),Ka=Ya,Xa=Va,tr={add:function(t,e,a){return t[e]=this.value,{newDocument:a}},remove:function(t,e,a){var r=t[e];return delete t[e],{newDocument:a,removed:r}},replace:function(t,e,a){var r=t[e];return t[e]=this.value,{newDocument:a,removed:r}},move:function(t,e,a){var r=ar(a,this.path);r&&(r=Va(r));var n=rr(a,{op:"remove",path:this.from}).removed;return rr(a,{op:"add",path:this.path,value:n}),{newDocument:a,removed:r}},copy:function(t,e,a){var r=ar(a,this.from);return rr(a,{op:"add",path:this.path,value:Va(r)}),{newDocument:a}},test:function(t,e,a){return{newDocument:a,test:sr(t[e],this.value)}},_get:function(t,e,a){return this.value=t[e],{newDocument:a}}},er={add:function(t,e,a){return Ha(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:a,index:e}},remove:function(t,e,a){return{newDocument:a,removed:t.splice(e,1)[0]}},replace:function(t,e,a){var r=t[e];return t[e]=this.value,{newDocument:a,removed:r}},move:tr.move,copy:tr.copy,test:tr.test,_get:tr._get};function ar(t,e){if(""==e)return t;var a={op:"_get",path:e};return rr(t,a),a.value}function rr(t,e,a,r,n,o){if(void 0===a&&(a=!1),void 0===r&&(r=!0),void 0===n&&(n=!0),void 0===o&&(o=0),a&&("function"==typeof a?a(e,0,t,e.path):or(e,0)),""===e.path){var i={newDocument:t};if("add"===e.op)return i.newDocument=e.value,i;if("replace"===e.op)return i.newDocument=e.value,i.removed=t,i;if("move"===e.op||"copy"===e.op)return i.newDocument=ar(t,e.from),"move"===e.op&&(i.removed=t),i;if("test"===e.op){if(i.test=sr(t,e.value),!1===i.test)throw new Ka("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return i.newDocument=t,i}if("remove"===e.op)return i.removed=t,i.newDocument=null,i;if("_get"===e.op)return e.value=t,i;if(a)throw new Ka("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,e,t);return i}r||(t=Va(t));var s=(e.path||"").split("/"),c=t,l=1,d=s.length,u=void 0,p=void 0,f=void 0;for(f="function"==typeof a?a:or;;){if(p=s[l],n&&"__proto__"==p)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(a&&void 0===u&&(void 0===c[p]?u=s.slice(0,l).join("/"):l==d-1&&(u=e.path),void 0!==u&&f(e,0,t,u)),l++,Array.isArray(c)){if("-"===p)p=c.length;else{if(a&&!Ha(p))throw new Ka("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,e,t);Ha(p)&&(p=~~p)}if(l>=d){if(a&&"add"===e.op&&p>c.length)throw new Ka("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,e,t);if(!1===(i=er[e.op].call(e,c,p,t)).test)throw new Ka("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return i}}else if(p&&-1!=p.indexOf("~")&&(p=Ga(p)),l>=d){if(!1===(i=tr[e.op].call(e,c,p,t)).test)throw new Ka("Test operation failed","TEST_OPERATION_FAILED",o,e,t);return i}c=c[p]}}function nr(t,e,a,r,n){if(void 0===r&&(r=!0),void 0===n&&(n=!0),a&&!Array.isArray(e))throw new Ka("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Va(t));for(var o=new Array(e.length),i=0,s=e.length;i<s;i++)o[i]=rr(t,e[i],a,!0,n,i),t=o[i].newDocument;return o.newDocument=t,o}function or(t,e,a,r){if("object"!=typeof t||null===t||Array.isArray(t))throw new Ka("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,a);if(!tr[t.op])throw new Ka("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,a);if("string"!=typeof t.path)throw new Ka("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,a);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new Ka('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,a);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new Ka("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,a);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new Ka("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,a);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&Qa(t.value))throw new Ka("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,a);if(a)if("add"==t.op){var n=t.path.split("/").length,o=r.split("/").length;if(n!==o+1&&n!==o)throw new Ka("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,a)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==r)throw new Ka("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,a)}else if("move"===t.op||"copy"===t.op){var i=ir([{op:"_get",path:t.from,value:void 0}],a);if(i&&"OPERATION_PATH_UNRESOLVABLE"===i.name)throw new Ka("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,a)}}function ir(t,e,a){try{if(!Array.isArray(t))throw new Ka("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)nr(Va(e),Va(t),a||!0);else{a=a||or;for(var r=0;r<t.length;r++)a(t[r],r,e,void 0)}}catch(n){if(n instanceof Ka)return n;throw n}}function sr(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var a,r,n,o=Array.isArray(t),i=Array.isArray(e);if(o&&i){if((r=t.length)!=e.length)return!1;for(a=r;0!=a--;)if(!sr(t[a],e[a]))return!1;return!0}if(o!=i)return!1;var s=Object.keys(t);if((r=s.length)!==Object.keys(e).length)return!1;for(a=r;0!=a--;)if(!e.hasOwnProperty(s[a]))return!1;for(a=r;0!=a--;)if(!sr(t[n=s[a]],e[n]))return!1;return!0}return t!=t&&e!=e}var cr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",JsonPatchError:Ka,deepClone:Xa,getValueByPointer:ar,applyOperation:rr,applyPatch:nr,applyReducer:function(t,e,a){var r=rr(t,e);if(!1===r.test)throw new Ka("Test operation failed","TEST_OPERATION_FAILED",a,e,t);return r.newDocument},validator:or,validate:ir,_areEquals:sr}),lr=new WeakMap,dr=function(t){this.observers=new Map,this.obj=t},ur=function(t,e){this.callback=t,this.observer=e};
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */function pr(t,e){void 0===e&&(e=!1);var a=lr.get(t.object);fr(a.value,t.object,t.patches,"",e),t.patches.length&&nr(a.value,t.patches);var r=t.patches;return r.length>0&&(t.patches=[],t.callback&&t.callback(r)),r}function fr(t,e,a,r,n){if(e!==t){"function"==typeof e.toJSON&&(e=e.toJSON());for(var o=Ua(e),i=Ua(t),s=!1,c=i.length-1;c>=0;c--){var l=t[u=i[c]];if(!Fa(e,u)||void 0===e[u]&&void 0!==l&&!1===Array.isArray(e))Array.isArray(t)===Array.isArray(e)?(n&&a.push({op:"test",path:r+"/"+Wa(u),value:Va(l)}),a.push({op:"remove",path:r+"/"+Wa(u)}),s=!0):(n&&a.push({op:"test",path:r,value:t}),a.push({op:"replace",path:r,value:e}));else{var d=e[u];"object"==typeof l&&null!=l&&"object"==typeof d&&null!=d?fr(l,d,a,r+"/"+Wa(u),n):l!==d&&(n&&a.push({op:"test",path:r+"/"+Wa(u),value:Va(l)}),a.push({op:"replace",path:r+"/"+Wa(u),value:Va(d)}))}}if(s||o.length!=i.length)for(c=0;c<o.length;c++){var u;Fa(t,u=o[c])||void 0===e[u]||a.push({op:"add",path:r+"/"+Wa(u),value:Va(e[u])})}}}var mr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",unobserve:function(t,e){e.unobserve()},observe:function(t,e){var a,r=function(t){return lr.get(t)}(t);if(r){var n=function(t,e){return t.observers.get(e)}(r,e);a=n&&n.observer}else r=new dr(t),lr.set(t,r);if(a)return a;if(a={},r.value=Va(t),e){a.callback=e,a.next=null;var o=function(){pr(a)},i=function(){clearTimeout(a.next),a.next=setTimeout(o)};"undefined"!=typeof window&&(window.addEventListener("mouseup",i),window.addEventListener("keyup",i),window.addEventListener("mousedown",i),window.addEventListener("keydown",i),window.addEventListener("change",i))}return a.patches=[],a.object=t,a.unobserve=function(){pr(a),clearTimeout(a.next),function(t,e){t.observers.delete(e.callback)}(r,a),"undefined"!=typeof window&&(window.removeEventListener("mouseup",i),window.removeEventListener("keyup",i),window.removeEventListener("mousedown",i),window.removeEventListener("keydown",i),window.removeEventListener("change",i))},r.observers.set(e,new ur(e,a)),a},generate:pr,compare:function(t,e,a){void 0===a&&(a=!1);var r=[];return fr(t,e,r,"",a),r}});Object.assign({},cr,mr,{JsonPatchError:Ya,deepClone:Va,escapePathComponent:Wa,unescapePathComponent:Ga}),new g("accessRights"),new g("documentTemplate"),new g("contributorInput"),new g("citationRender"),new g("clipboard"),new g("collabCarets"),new g("comments"),new g("footnoteMarkers"),new g("header"),new g("jump-hidden-nodes"),new g("links"),new g("marginboxes"),new g("tableMenu"),new g("placeholders"),new g("toolbar"),new g("settings"),new g("table"),new g("figureMenu"),new g("tagInput");function hr(t){const e={decos:q.empty};return t.setMeta(vr,e).setMeta("track",!0)}function gr(t,e,a){const r=t.resolve(e),n=r.parent,o=n.childAfter(r.parentOffset);if(!o.node)return null;let i=r.index(),s=r.start()+o.offset;for(;i>0&&a.isInSet(n.child(i-1).marks);)s-=n.child(--i).nodeSize;let c=r.index()+1,l=r.start()+o.offset+o.node.nodeSize;for(;c<n.childCount&&a.isInSet(n.child(c).marks);)l+=n.child(c++).nodeSize;return{from:s,to:l}}new p({nodes:{doc:{content:"tag"},tag:{content:"inline*",parseDOM:[{tag:"div.tag-input-editor"}],toDOM:()=>["div",{class:"tag-input-editor"},0]},text:{group:"inline"}},marks:{}}),new g("tocRender"),new g("toolbar");const vr=new g("track"),yr={},kr={},br={},wr={};function Or(t){return new $({key:vr,state:{init(e,a){const r=[t.editor.user.id];return a.doc.descendants((t=>{t.attrs.track?t.attrs.track.forEach((t=>{r.includes(t.user)||0===t.user||r.push(t.user)})):t.marks.forEach((t=>{["deletion","insertion","format_change"].includes(t.type.name)&&!r.includes(t.attrs.user)&&0!==t.attrs.user&&r.push(t.attrs.user)}))})),t.editor.mod.collab&&r.forEach((e=>t.editor.mod.collab.colors.ensureUserColor(e))),{decos:q.empty}},apply(t,e,a,r){const n=t.getMeta(vr);if(n)return n;let{decos:o}=this.getState(a);if(t.selectionSet){const{insertion:e,deletion:a,formatChange:n}=function(t){const e=t.selection,a={insertion:!1,deletion:!1,formatChange:!1};let r,n,o,i,s,c,l=!1,d=!1,u=!1;if(e.empty){const a=t.doc.resolve(e.from).marks();a&&(r=a.find((t=>"insertion"===t.type.name&&!t.attrs.approved)),r&&(l=e.from),n=a.find((t=>"deletion"===t.type.name)),n&&(d=e.from),o=a.find((t=>"format_change"===t.type.name)),o&&(u=e.from))}else t.doc.nodesBetween(e.from,e.to,((t,a)=>{if(a<e.from)return!0;r||(r=t.attrs.track?t.attrs.track.find((t=>"insertion"===t.type)):t.marks.find((t=>"insertion"===t.type.name&&!t.attrs.approved)),r&&(l=a,t.isInline||(i=t.nodeSize))),n||(n=t.attrs.track?t.attrs.track.find((t=>"deletion"===t.type)):t.marks.find((t=>"deletion"===t.type.name)),n&&(d=a,t.isInline||(s=t.nodeSize))),o||(o=t.marks.find((t=>"format_change"===t.type.name)),o&&(u=a,t.isInline||(c=t.nodeSize)))}));return r&&(a.insertion=i?{from:l,to:l+i}:gr(t.doc,l,r)),n&&(a.deletion=s?{from:d,to:d+s}:gr(t.doc,d,n)),o&&(a.formatChange=c?{from:u,to:u+c}:gr(t.doc,u,o)),a}(r);o=q.empty;const i=t.selection.node?J.node:J.inline;e&&(o=o.add(t.doc,[i(e.from,e.to,{class:"selected-insertion"},yr)])),a&&(o=o.add(t.doc,[i(a.from,a.to,{class:"selected-deletion"},kr)])),n&&(o=o.add(t.doc,[i(n.from,n.to,{class:"selected-format_change"},br)]))}else o=o.map(t.mapping,t.doc);return{decos:o}}},props:{decorations(t){const{decos:e}=this.getState(t);return e},handleDOMEvents:{focus:(e,a)=>{const r=e===t.editor.view?t.editor.mod.footnotes.fnEditor.view:t.editor.view;r.dispatch(hr(r.state.tr))}}}})}new g("search");const Mr=function(t,e,a,r,n){const o=r.map(a),i=n?"deletion":"insertion";let s;if(e.isTextblock){const a=F.findFrom(t.doc.resolve(o),-1);if(a instanceof U){const r=a.$anchor.pos,n=o+1;let c=!0;if(t.doc.nodesBetween(r,n,((t,e)=>{if(e<r)return!0;t.type.spec.isolating&&(c=!1)})),c)s=V(t.doc,r,n);else{const a=e.attrs.track.filter((t=>t.type!==i));t.setNodeMarkup(o,null,Object.assign({},e.attrs,{track:a}),e.marks)}}else{const a=e.attrs.track.filter((t=>t.type!==i));t.setNodeMarkup(o,null,Object.assign({},e.attrs,{track:a}),e.marks)}}else if(e.isLeaf||["figure","table"].includes(e.type.name))s=new H(o,r.map(a+e.nodeSize),W.empty);else if(e.type===t.doc.type.schema.nodes.list_item){const a=G.create({doc:t.doc,selection:F.findFrom(t.doc.resolve(o),1)});Q(e.type)(a,(e=>{e.steps.forEach((e=>{t.step(e),r.appendMap(e.getMap())}))}))}else{const t=r.map(a+e.nodeSize);s=new Z(o,t,o+1,t-1,W.empty,0,!0)}if(s){t.step(s);const e=s.getMap();r.appendMap(e)}},_r=function(t,e=0,a=!1){a||(a=t.state.doc.content.size);const r=t.state.tr.setMeta("track",!0),n=new Y;t.state.doc.nodesBetween(e,a,((o,i)=>{var s,c,l,d;if(i<e&&!o.isInline)return!0;let u=!1;if(null==(s=o.attrs.track)?void 0:s.find((t=>"insertion"===t.type)))Mr(r,o,i,n,!1),u=!0;else if(null==(c=o.marks)?void 0:c.find((t=>"insertion"===t.type.name&&!t.attrs.approved))){const t=new H(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),W.empty);r.step(t),n.appendMap(t.getMap()),u=!0}else if(null==(l=o.attrs.track)?void 0:l.find((t=>"deletion"===t.type))){const t=o.attrs.track.filter((t=>"deletion"!==t.type));r.setNodeMarkup(n.map(i),null,Object.assign({},o.attrs,{track:t}),o.marks)}else(null==(d=o.marks)?void 0:d.find((t=>"deletion"===t.type.name)))&&r.removeMark(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),t.state.schema.marks.deletion);const p=o.marks.find((t=>"format_change"===t.type.name));if(o.isInline&&!u&&p&&(p.attrs.before.forEach((s=>r.step(new K(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),t.state.schema.marks[s].create())))),p.attrs.after.forEach((t=>{r.step(new X(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),o.marks.find((e=>e.type.name===t))))})),r.step(new X(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),p))),!o.isInline&&!u&&o.attrs.track){const e=o.attrs.track.find((t=>"block_change"===t.type));if(e){const a=o.attrs.track.filter((t=>t!==e));r.setNodeMarkup(n.map(i),t.state.schema.nodes[e.before.type],Object.assign({},o.attrs,e.before.attrs,{track:a}),o.marks)}}return!0})),hr(r),r.steps.length&&t.dispatch(r)},Ar=function(t,e=0,a=!1){a||(a=t.state.doc.content.size);const r=t.state.tr.setMeta("track",!0),n=new Y;t.state.doc.nodesBetween(e,a,((o,i)=>{var s,c,l,d;if(i<e&&!o.isInline)return!0;let u=!1;if(null==(s=o.attrs.track)?void 0:s.find((t=>"deletion"===t.type)))Mr(r,o,i,n,!0),u=!0;else if(null==(c=o.marks)?void 0:c.find((t=>"deletion"===t.type.name))){const t=new H(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),W.empty);r.step(t),n.appendMap(t.getMap()),u=!0}else if(null==(l=o.attrs.track)?void 0:l.find((t=>"insertion"===t.type))){const t=o.attrs.track.filter((t=>"insertion"!==t.type));r.setNodeMarkup(n.map(i),null,Object.assign({},o.attrs,{track:t}),o.marks)}else if(null==(d=o.marks)?void 0:d.find((t=>"insertion"===t.type.name&&!t.attrs.approved))){const s=o.marks.find((t=>"insertion"===t.type.name)),c=Object.assign({},s.attrs,{approved:!0});r.step(new K(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),t.state.schema.marks.insertion.create(c)))}const p=o.marks.find((t=>"format_change"===t.type.name));if(o.isInline&&!u&&p&&r.step(new X(n.map(Math.max(i,e)),n.map(Math.min(i+o.nodeSize,a)),p)),!o.isInline&&!u&&o.attrs.track){const t=o.attrs.track.find((t=>"block_change"===t.type));if(t){const e=o.attrs.track.filter((e=>e!==t));r.setNodeMarkup(n.map(i),null,Object.assign({},o.attrs,{track:e}),o.marks)}}return!0})),hr(r),r.steps.length&&t.dispatch(r)};class Sr{constructor(t){t.mod.track=this,this.editor=t,this.bindEvents()}bindEvents(){document.body.addEventListener("click",(t=>{const e={};switch(!0){case st(t,".track-accept",e):{let t=0,a=e.target.closest(".margin-box");for(;a.previousElementSibling;)t+=1,a=a.previousElementSibling;const r=this.editor.mod.marginboxes.marginBoxes[t];!function(t,e,a){const r=a.state.tr.setMeta("track",!0),n=new Y;let o=!1;const i=a.state.doc.nodeAt(e).marks.find((e=>e.type.name===t));a.state.doc.nodesBetween(e,a.state.doc.nodeSize-2,((s,c)=>{if(c<e)return!0;if(o)return!1;if(s.isInline){if(!i.isInSet(s.marks))return o=!0,!1}else o=!0;if(void 0===i||i&&i.isInSet(s.marks)){if("deletion"===t)Mr(r,s,c,n,!0);else if("insertion"===t)if(s.attrs.track){const t=s.attrs.track.filter((t=>"insertion"!==t.type));if(s.attrs.track.length===t)return!0;r.setNodeMarkup(n.map(c),null,Object.assign({},s.attrs,{track:t}),s.marks),"list_item"===s.type.name&&s.child(0)&&"paragraph"===s.child(0).type.name&&(o=!1)}else r.step(new K(n.map(c),n.map(c+s.nodeSize),a.state.schema.marks.insertion.create(Object.assign({},i.attrs,{approved:!0}))));else if("format_change"===t)r.step(new X(n.map(c),n.map(c+s.nodeSize),i));else if("block_change"===t){const t=s.attrs.track.filter((t=>"block_change"!==t.type));r.setNodeMarkup(n.map(c),null,Object.assign({},s.attrs,{track:t}),s.marks)}return!0}return!0})),hr(r),r.steps.length&&a.dispatch(r)}(e.target.dataset.type,r.pos,"main"===r.view?this.editor.view:this.editor.mod.footnotes.fnEditor.view);break}case st(t,".track-reject",e):{let t=0,a=e.target.closest(".margin-box");for(;a.previousElementSibling;)t+=1,a=a.previousElementSibling;const r=this.editor.mod.marginboxes.marginBoxes[t];!function(t,e,a){const r=a.state.tr.setMeta("track",!0),n=new Y;let o=!1,i=!1;const s=a.state.doc.nodeAt(e).marks.find((e=>e.type.name===t));a.state.doc.nodesBetween(e,a.state.doc.nodeSize-2,((c,l)=>{var d,u;if(l<e)return!0;if(o)return!1;if(c.isInline){if(!s.isInSet(c.marks))return o=!0,!1;i=!0}else if(o=!0,i)return!1;if("insertion"===t)Mr(r,c,l,n,!1);else if("deletion"===t)if(c.attrs.track){const t=c.attrs.track.filter((t=>"deletion"!==t.type));r.setNodeMarkup(n.map(l),null,Object.assign({},c.attrs,{track:t}),c.marks),o=!0}else r.removeMark(n.map(l),n.map(l+c.nodeSize),a.state.schema.marks.deletion);else if("format_change"===t)s.attrs.before.forEach((t=>r.step(new K(n.map(l),n.map(l+c.nodeSize),a.state.schema.marks[t].create())))),s.attrs.after.forEach((t=>{r.step(new X(n.map(l),n.map(l+c.nodeSize),c.marks.find((e=>e.type.name===t))))})),r.step(new X(n.map(l),n.map(l+c.nodeSize),s));else if("block_change"===t){const t=null==(d=c.attrs.track)?void 0:d.find((t=>"block_change"===t.type)),e=null==(u=c.attrs.track)?void 0:u.filter((e=>e!==t));if(!t)return!0;r.setNodeMarkup(n.map(l),a.state.schema.nodes[t.before.type],Object.assign({},c.attrs,t.before.attrs,{track:e}),c.marks)}return!0})),hr(r),r.steps.length&&a.dispatch(r)}(e.target.dataset.type,r.pos,"main"===r.view?this.editor.view:this.editor.mod.footnotes.fnEditor.view);break}}}))}activateTrack(t,e,a){this.editor.mod.comments.interactions.deactivateAll();const r="main"===t?this.editor.view:this.editor.mod.footnotes.fnEditor.view,n="main"===t?this.editor.mod.footnotes.fnEditor.view:this.editor.view;n.dispatch(hr(n.state.tr));const o=function(t,e,a){const r=t.tr,n=r.doc.nodeAt(a),o=n.attrs.track?n.attrs.track.find((t=>t.type===e)):n.marks.find((t=>t.type.name===e));if(!o)return;const i=n.isInline?gr(r.doc,a,o):{from:a,to:a+n.nodeSize};let s,c=q.empty;"insertion"===e?s=yr:"deletion"===e?s=kr:"format_change"===e?s=br:"block_change"===e&&(s=wr);const l=n.isInline?J.inline:J.node;return c=c.add(r.doc,[l(i.from,i.to,{class:`selected-${e}`},s)]),r.setMeta(vr,{decos:c}).setMeta("track",!0)}(r.state,e,a);o&&(this.editor.currentView=r,r.dispatch(o))}rejectAll(){_r(this.editor.mod.footnotes.fnEditor.view),_r(this.editor.view)}acceptAll(){Ar(this.editor.mod.footnotes.fnEditor.view),Ar(this.editor.view)}}function Dr(t,e,a,r,n,o,i){const s=t.doc.type.schema.marks.insertion.create({user:r.id,username:r.username,date:o,approved:i});t.doc.nodesBetween(e,a,((o,c)=>{if(o.isInline)return t.removeMark(Math.max(e,c),Math.min(c+o.nodeSize,a),t.doc.type.schema.marks.deletion),t.removeMark(Math.max(e,c),Math.min(c+o.nodeSize,a),t.doc.type.schema.marks.insertion),t.addMark(Math.max(e,c),Math.min(c+o.nodeSize,a),s),!1;if(c<e||["bullet_list","ordered_list"].includes(o.type.name))return!0;if(["table_row","table_cell"].includes(o.type.name))return!1;if(o.attrs.track){const e=[];i||e.push({type:"insertion",user:r.id,username:r.username,date:n}),t.setNodeMarkup(c,null,Object.assign({},o.attrs,{track:e}),o.marks)}return!["figure","table"].includes(o.type.name)&&void 0}))}function Er(t,e,a,r,n,o){const i=t.doc.type.schema.marks.deletion.create({user:r.id,username:r.username,date:o});let s=!1,c=!1;const l=new Y;return t.doc.nodesBetween(e,a,((o,d,u,p)=>{var f,m;if(d<e&&"table_cell"===o.type.name)return s=!0,!0;if(d<e&&o.isBlock||s)return s=!1,!0;if(["table_row","table_cell"].includes(o.type.name))return!1;if(o.isInline&&o.marks.find((t=>"insertion"===t.type.name&&t.attrs.user===r.id&&!t.attrs.approved))){const r=new H(l.map(Math.max(e,d)),l.map(Math.min(a,d+o.nodeSize)),W.empty);t.maybeStep(r).failed||l.appendMap(r.getMap())}else if(o.isInline&&!o.marks.find((t=>"deletion"===t.type.name)))t.addMark(l.map(Math.max(e,d)),l.map(Math.min(a,d+o.nodeSize)),i);else if(!(null==(f=o.attrs.track)?void 0:f.find((t=>"deletion"===t.type)))&&!["bullet_list","ordered_list"].includes(o.type.name)){if(null==(m=o.attrs.track)?void 0:m.find((t=>"insertion"===t.type&&t.user===r.id))){let r;if(o.isTextblock&&a<d+o.nodeSize){const e=F.findFrom(t.doc.resolve(d),-1);e instanceof U&&(r=new H(l.map(e.$anchor.pos),l.map(a),W.empty))}else r=new H(l.map(Math.max(e,d)),l.map(Math.min(a,d+o.nodeSize)),W.empty);t.maybeStep(r).failed||l.appendMap(r.getMap()),"list_item"===o.type.name&&c&&(c=!1)}else if(o.attrs.track){if("list_item"===o.type.name){if(p)return;c=!0}else if(c)return void(c=!1);const e=o.attrs.track.slice();e.push({type:"deletion",user:r.id,username:r.username,date:n}),t.setNodeMarkup(l.map(d),null,Object.assign({},o.attrs,{track:e}),o.marks)}if("figure"===o.type.name)return!1}})),l}function Nr(t,e,a){return!t.steps.length||t.meta&&!Object.keys(t.meta).every((t=>["inputType","uiEvent","paste"].includes(t)))||["historyUndo","historyRedo"].includes(t.getMeta("inputType"))?t:function(t,e,a,r,n){const o=e.tr,i=new Y,s=10*Math.floor(n/6e5),c=Math.floor(n/6e4),l=["deleteContentBackward","deleteContentForward"].includes(t.getMeta("inputType"))&&e.selection instanceof tt;t.steps.forEach(((n,d)=>{const u=n.map(i),p=o.doc;if(u)if(u instanceof H){const p=r?u:!(!u.slice.size||l)&&new H(u.to,u.to,u.slice,u.structure),f=n.invert(t.docs[d]).map(i);if(i.appendMap(f.getMap()),p){const t=e.apply(o).tr;if(!t.maybeStep(p).failed){const e=p.getMap().map(p.to);Dr(t,p.from,e,a,c,s,r);const n=new H(p.from,p.to,t.doc.slice(p.from,e));o.step(n);const l=i.maps.length-1;i.appendMap(n.getMap(),l),o.selection.eq(t.selection)||o.setSelection(o.doc,F.fromJSON(t.selection.toJSON()))}}r||u.from===u.to||i.appendMap(Er(o,u.from,u.to,a,c,s))}else if(r)o.step(u);else if(u instanceof Z)if(u.from===u.gapFrom&&u.to===u.gapTo){o.step(u);const t=u.getMap().map(u.from,-1),e=u.getMap().map(u.gapFrom);Dr(o,t,e,a,c,s,!1)}else if(u.slice.size)if(2===u.slice.size&&u.gapFrom-u.from==1&&u.to-u.gapTo==1){o.step(u);const t=p.nodeAt(u.from);t.attrs.track&&function(t,e,a,r,n,o){let i=a.attrs.track.slice(),s=i.find((t=>"block_change"===t.type));s?(i=i.filter((t=>t!==s)),s.before.type===r.type.name&&s.before.attrs.level===r.attrs.level||(s={type:"block_change",user:n.id,username:n.username,date:o,before:s.before},i.push(s))):(s={type:"block_change",user:n.id,username:n.username,date:o,before:{type:a.type.name,attrs:a.attrs}},s.before.attrs.id&&delete s.before.attrs.id,s.before.attrs.track&&delete s.before.attrs.track,i.push(s)),t.setNodeMarkup(e,null,Object.assign({},r.attrs,{track:i}))}(o,u.from,t,u.slice.content.firstChild,a,c)}else{o.step(u);[{from:u.getMap().map(u.from,-1),to:u.getMap().map(u.gapFrom)},{from:u.getMap().map(u.gapTo,-1),to:u.getMap().map(u.to)}].forEach((t=>p.nodesBetween(t.from,t.to,((e,r)=>{if(r<t.from)return!0;Dr(o,t.from,t.to,a,c,s,!1)}))))}else{const e=n.invert(t.docs[d]).map(i);i.appendMap(e.getMap()),i.appendMap(Er(o,u.from,u.gapFrom,a,c,s))}else u instanceof K?p.nodesBetween(u.from,u.to,((t,r)=>{if(!t.isInline)return!0;if(t.marks.find((t=>"deletion"===t.type.name)))return!1;if(o.addMark(Math.max(u.from,r),Math.min(u.to,r+t.nodeSize),u.mark),["em","strong","underline"].includes(u.mark.type.name)&&!t.marks.find((t=>t.type===u.mark.type))){const n=t.marks.find((t=>"format_change"===t.type.name));let i,c;n?n.attrs.before.includes(u.mark.type.name)?(c=n.attrs.before.filter((t=>t!==u.mark.type.name)),i=n.attrs.after):(c=n.attrs.before,i=n.attrs.after.concat(u.mark.type.name)):(c=[],i=[u.mark.type.name]),i.length||c.length?o.addMark(Math.max(u.from,r),Math.min(u.to,r+t.nodeSize),e.schema.marks.format_change.create({user:a.id,username:a.username,date:s,before:c,after:i})):n&&o.removeMark(Math.max(u.from,r),Math.min(u.to,r+t.nodeSize),n)}})):u instanceof X&&p.nodesBetween(u.from,u.to,((t,r)=>{if(!t.isInline)return!0;if(t.marks.find((t=>"deletion"===t.type.name)))return!1;if(o.removeMark(Math.max(u.from,r),Math.min(u.to,r+t.nodeSize),u.mark),["em","strong","underline"].includes(u.mark.type.name)&&t.marks.find((t=>t.type===u.mark.type))){const n=t.marks.find((t=>"format_change"===t.type.name));let i,c;n?n.attrs.after.includes(u.mark.type.name)?(i=n.attrs.after.filter((t=>t!==u.mark.type.name)),c=n.attrs.before):(i=n.attrs.after,c=n.attrs.before.concat(u.mark.type.name)):(i=[],c=[u.mark.type.name]),i.length||c.length?o.addMark(Math.max(u.from,r),Math.min(u.to,r+t.nodeSize),e.schema.marks.format_change.create({user:a.id,username:a.username,date:s,before:c,after:i})):n&&o.removeMark(Math.max(u.from,r),Math.min(u.to,r+t.nodeSize),n)}}))})),t.getMeta("inputType")&&o.setMeta(t.getMeta("inputType"));t.getMeta("uiEvent")&&o.setMeta(t.getMeta("uiEvent"));if(t.selectionSet)if(t.selection instanceof U&&(t.selection.from<e.selection.from||"deleteContentBackward"===t.getMeta("inputType"))){const e=i.map(t.selection.from,-1);o.setSelection(new U(o.doc.resolve(e)))}else o.setSelection(t.selection.map(o.doc,i));t.storedMarksSet&&o.setStoredMarks(t.storedMarks);t.scrolledIntoView&&o.scrollIntoView();return o}(t,e,a.user,!a.view.state.doc.firstChild.attrs.tracked&&"write-tracked"!==a.docInfo.access_rights,Date.now()-a.clientTimeAdjustment)}class Tr{constructor(){this.docSource=document.querySelector("#edit-me");const t=new p({nodes:_.spec.nodes,marks:(r=s({},_.spec.marks),n={insertion:ht,deletion:pt,format_change:mt},e(r,a(n)))});var r,n;this.schema=s({},t),this.plugins=[],this.plugins.push(et((t=>{const e={Backspace:(t,e,a)=>Sa(t,(t=>e(Da(t,"deleteContentBackward"))),a),"Mod-z":(t,e,a)=>O(t,(t=>e(Da(t,"historyUndo")))),"Shift-Mod-z":(t,e,a)=>M(t,(t=>e(Da(t,"historyRedo")))),"Shift-Ctrl-0":Ea(t.nodes.paragraph),"Shift-Ctrl-\\":Ea(t.nodes.code_block)};for(let a=1;a<=6;a++)e["Shift-Ctrl-"+a]=Ea(t.nodes.heading,{level:a});return Aa||(e["Mod-y"]=(t,e,a)=>M(t,(t=>e(Da(t,"historyRedo"))))),e})(this.schema))),this.plugins.push(et(at(this.schema))),this.plugins.push(et(ot)),this.plugins.push(Or({editor:this}));var o=rt({schema:ve,menuBar:!0,floatingMenu:!0}).filter((t=>{var e,a;return!Boolean(null==(e=t.props)?void 0:e.handleKeyDown)&&!Boolean(null==(a=t.props)?void 0:a.handleTextInput)}));this.plugins.push(...o);const i=document.createElement("div");i.classList.add("text-editor"),this.docSource.parentNode.insertBefore(i,this.docSource),this.docSource.style.display="none",this.docSource.classList.add("edit-original");let c=!1;this.clientTimeAdjustment=0,this.user={id:0,username:"root"},this.mod={},this.docInfo={},this.docInfo.updated=null,this.docInfo.access_rights="write-tracked",this.schema=ve,this.view=new nt(i,{state:G.create({doc:f.fromSchema(this.schema).parse(this.docSource),plugins:this.plugins}),handleDOMEvents:{focus:(t,e)=>{c||(this.currentView=this.view,c=!0,t.focus(),c=!1)}},dispatchTransaction:t=>{const e=Nr(t,this.view.state,this),{state:a,transactions:r}=this.view.state.applyTransaction(e);this.view.updateState(a),t.steps&&(this.docInfo.updated=new Date)}}),this.currentView=this.view,this.mod.footnotes={fnEditor:{view:{dispatch:()=>{},state:{tr:{setMeta:function(){return this}}}}}},new Sr(this)}}document.body.onload=function(){new Tr};
